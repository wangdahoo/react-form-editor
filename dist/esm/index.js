import e,{useState as t,useRef as n,useCallback as a,useEffect as r}from"react";import{useDrag as l,useDrop as i,DndProvider as o}from"react-dnd";import u from"react-dnd-html5-backend";import{message as m,Divider as c,Button as s,Input as d,InputNumber as f,Radio as p,Checkbox as v,Select as E,Modal as h,Row as y,Col as g,List as b,Tabs as T,Layout as N}from"antd";import{observer as C}from"mobx-react";import{observable as x,computed as O}from"mobx";import{generate as A}from"shortid";import I from"immutability-helper";import S from"classnames";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var R=function(e,t){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function k(e,t){function n(){this.constructor=e}R(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var U,B=function(){return(B=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function D(e,t,n,a){var r,l=arguments.length,i=l<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(i=(l<3?r(i):l>3?r(t,n,i):r(t,n))||i);return l>3&&i&&Object.defineProperty(t,n,i),i}!function(e){e.TEXT="text",e.INPUT="input",e.NUMBER="number",e.TEXTAREA="textarea",e.CHECKBOX="checkbox",e.RADIO="radio",e.SELECT="select",e.LAYOUT="layout",e.RESULT="result"}(U||(U={}));var w=function(e){return{value:e,text:e}};var L=new(function(){function e(){this.items=[],this.activeId=""}return e.prototype.setItems=function(e){this.items=e,this.activeId=""},e.prototype.getItems=function(){return this.items.slice(0)},e.prototype.add=function(e){if(e===U.RESULT&&this.items.filter((function(e){return e.itemType===U.RESULT})).length>0)m.error("检验结果字段只能有一个");else{var t=function(e){var t=A();switch(e){case U.RESULT:return{id:t,itemType:e,labelText:"检验结果"};case U.TEXT:return{id:t,itemType:e,content:"文字内容",fontSize:14,lineHeight:21,textAlign:"left"};case U.LAYOUT:return{id:t,itemType:e,rows:[[{span:12},{span:12}]]};case U.SELECT:return{id:t,itemType:e,labelText:"下拉选择框",options:[w("选项 1"),w("选项 2"),w("选项 3")],defaultValue:"选项 1"};case U.RADIO:return{id:t,itemType:e,labelText:"单选框",options:[w("选项 1"),w("选项 2")],buttonStyle:"solid",defaultValue:"",required:!0};case U.CHECKBOX:return{id:t,itemType:e,labelText:"多选框",options:[w("选项 1")],defaultValue:[],required:!0};case U.TEXTAREA:return{id:t,itemType:e,labelText:"文本域",placeholder:"文本域输入提示",defaultValue:"",required:!0};case U.NUMBER:return{id:t,itemType:e,labelText:"数字框",defaultValue:1,min:1,max:100,unit:""};default:return{id:t,itemType:U.INPUT,labelText:"文本框",placeholder:"文本框输入提示",defaultValue:"",required:!0}}}(e);this.items.push(t)}},e.prototype.delete=function(e){this.items=this.items.filter((function(t){return t.id!==e}))},e.prototype.update=function(e){this.items=this.items.map((function(t){return t.id===e.id?e:t}))},e.prototype.activate=function(e){this.items.filter((function(t){return t.id===e})).length>0&&(this.activeId=e)},e.prototype.move=function(e,t){var n=this.items[e];this.items=I(this.items,{$splice:[[e,1],[t,0,n]]})},e.prototype.addOption=function(e){this.items=this.items.map((function(t){if(t.id===e&&[U.CHECKBOX,U.RADIO,U.SELECT].indexOf(t.itemType)>-1){t.options.push(w(""))}return t}))},e.prototype.deleteOption=function(e,t){this.items=this.items.map((function(n){return n.id===e&&[U.CHECKBOX,U.RADIO,U.SELECT].indexOf(n.itemType)>-1&&(n.options.length>1?(n.options.splice(t,1),U.SELECT===n.itemType&&(n.defaultValue=n.options[0].value),U.CHECKBOX===n.itemType&&(n.defaultValue=[]),U.RADIO===n.itemType&&(n.defaultValue="")):m.error("选项不得少于 1 个")),n}))},e.prototype.updateOption=function(e,t,n){this.items=this.items.map((function(a){return a.id===e&&[U.CHECKBOX,U.RADIO,U.SELECT].indexOf(a.itemType)>-1&&a.options.splice(t,1,w(n)),a}))},e.prototype.setCheckboxDefaultOption=function(e,t){this.items=this.items.map((function(n){return n.id===e&&U.CHECKBOX===n.itemType&&(n.defaultValue=t),n}))},e.prototype.setRadioDefaultOption=function(e,t){this.items=this.items.map((function(n){return n.id===e&&U.RADIO===n.itemType&&(n.defaultValue=t),n}))},e.prototype.setSelectDefaultOption=function(e,t){this.items=this.items.map((function(n){return n.id===e&&U.SELECT===n.itemType&&(n.defaultValue=t),n}))},e.prototype.addCol=function(e,t){this.items=this.items.map((function(n){return n.id===e&&U.LAYOUT===n.itemType&&n.rows[t].push({span:12}),n}))},e.prototype.updateColSpan=function(e,t,n,a){this.items=this.items.map((function(r){return r.id===e&&U.LAYOUT===r.itemType&&r.rows[t].splice(n,1,{span:a}),r}))},e.prototype.deleteCol=function(e,t,n){this.items=this.items.map((function(a){return a.id===e&&U.LAYOUT===a.itemType&&a.rows[t].splice(n,1),a}))},e.prototype.updateTextItem=function(e,t,n,a,r){this.items=this.items.map((function(l){return l.id===e&&U.TEXT===l.itemType&&(l.content=t,l.fontSize=n,l.lineHeight=a,l.textAlign=r),l}))},e.prototype.setRequired=function(e,t){this.items=this.items.map((function(n){return n.id===e&&(n.required=t),n}))},Object.defineProperty(e.prototype,"formItems",{get:function(){var e=this;return this.items.map((function(t){return B(B({},t),{isActive:t.id===e.activeId})}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeItem",{get:function(){return function(e,t){for(var n=null,a=0,r=e.length;a<r;a++){var l=e[a];if(l.id===t){n=l;break}}return n||{}}(this.items,this.activeId)},enumerable:!0,configurable:!0}),D([x],e.prototype,"items",void 0),D([x],e.prototype,"activeId",void 0),e}()),X=function(e){return{values:e.reduce((function(e,t){var n;return[U.INPUT,U.TEXTAREA,U.RADIO,U.CHECKBOX,U.SELECT].indexOf(t.itemType)>-1?B(B({},e),((n={})[t.id]=t.defaultValue,n)):e}),{}),result:-1,comment:""}};function W(n){var a=n.form,r=a.items,l=a.attrs,i=l.formWidth,o=l.formWidthUnit,u=l.labelAlign,m=l.labelWidth,h=t(X(r)),y=h[0],g=h[1],b=t({result:!1,errors:{}}),T=b[0],N=b[1],C=t(0),x=C[0],O=C[1];return e.createElement("div",{className:"generated-form",style:{width:""+i+o}},r.map((function(t,n){var a=t.itemType;if(a===U.TEXT){var r=t;return e.createElement("div",{key:n,className:"form-item form-item-text",style:{fontSize:r.fontSize,lineHeight:r.lineHeight+"px",textAlign:r.textAlign}},e.createElement("div",{className:"form-item-label"},r.content))}if([U.INPUT,U.NUMBER,U.TEXTAREA,U.RADIO,U.CHECKBOX,U.SELECT,U.RESULT].indexOf(a)>-1){var l=T.errors[t.id];return e.createElement("div",{className:"form-item",key:n},e.createElement("div",{className:S("form-item-label","top"===u?"label-standalone":""),style:B({width:m},"top"!==u?{textAlign:u}:{})},t.labelText),e.createElement("div",{className:"form-item-content"},function(t){switch(t.itemType){case U.RESULT:return e.createElement("div",null,e.createElement(p.Group,{style:{height:32,lineHeight:"32px",marginBottom:16},value:y.result,onChange:function(e){return g(B(B({},y),{result:e.target.value}))}},e.createElement(p,{value:1},"合格"),e.createElement(p,{value:0},"不合格"),e.createElement("span",{className:"err-msg"},x>0&&-1===y.result?"检验结果为必填项":"")),e.createElement(d.TextArea,{placeholder:"备注",value:y.comment,onChange:function(e){return g(B(B({},y),{comment:e.target.value}))}}));case U.SELECT:var n=t;return e.createElement(E,{value:y.values[n.id],onChange:function(e){var t,a=y.values;g(B(B({},y),{values:B(B({},a),(t={},t[n.id]=e,t))}))},style:{width:"100%"}},n.options.map((function(t,n){return e.createElement(E.Option,{key:n,value:t.value},t.text)})));case U.CHECKBOX:var a=t;return e.createElement(v.Group,{value:y.values[a.id],onChange:function(e){var t,n=y.values;g(B(B({},y),{values:B(B({},n),(t={},t[a.id]=e,t))}))}},a.options.map((function(t,n){return e.createElement(v,{key:n,value:t.value},t.text)})));case U.RADIO:var r=t;return e.createElement(p.Group,{value:y.values[r.id],onChange:function(e){var t,n=y.values;g(B(B({},y),{values:B(B({},n),(t={},t[r.id]=e.target.value,t))}))},buttonStyle:r.buttonStyle},r.options.map((function(t,n){return e.createElement(p.Button,{key:n,value:t.value},t.text)})));case U.TEXTAREA:var l=t;return e.createElement(d.TextArea,{value:y.values[l.id],onChange:function(e){var t,n=y.values;g(B(B({},y),{values:B(B({},n),(t={},t[l.id]=e.target.value,t))}))},placeholder:l.placeholder});case U.NUMBER:var i=t;return e.createElement(f,{style:{width:"100%"},value:y.values[i.id],onChange:function(e){var t;e=e||i.min;var n=y.values;g(B(B({},y),{values:B(B({},n),(t={},t[i.id]=e,t))}))},min:i.min,max:i.max,formatter:function(e){return e?e+" "+i.unit:i.min+" "+i.unit},parser:function(e){return Number(e?e.replace(" "+i.unit,""):i.min)}});default:var o=t;return e.createElement(d,{value:y.values[o.id],onChange:function(e){var t,n=y.values;g(B(B({},y),{values:B(B({},n),(t={},t[o.id]=e.target.value,t))}))},placeholder:o.placeholder})}}(t),e.createElement("div",{className:"err-msg"},l)))}return null})),e.createElement(c,null),e.createElement("div",{style:{paddingLeft:m}},e.createElement(s,{type:"primary",onClick:function(){console.log("form items =>",r),console.log("form values =>",y);var e=function(e,t){var n=t.values;return e.reduce((function(e,a){var r=e.result,l=e.errors;if(function(e){return[U.INPUT,U.TEXTAREA,U.CHECKBOX,U.RADIO].indexOf(e.itemType)>-1}(a)&&a.required){var i=a,o=i.id,u=i.labelText,m=n[o];("string"==typeof m&&""===m||"[object Array]"===Object.prototype.toString.call(m)&&0===m.length)&&(l[o]=u+"为必填项",r=!1)}return a.itemType===U.RESULT&&t.result,{result:r,errors:l}}),{result:!1,errors:{}})}(r,y);console.log(e),e.result?(n.onSubmit&&n.onSubmit(y),N({result:!1,errors:{}}),g(X(r))):N(e),O(x+1)},style:{width:90,marginRight:16}},"提 交"),e.createElement(s,{type:"default",onClick:function(){return g(X(r))},style:{width:90}},"重 置")))}var H=C((function(n){var a=n.form,r=n.formAttrs,l=n.onSave,i=t(!1),o=i[0],u=i[1],m=function(){return JSON.stringify({items:a.getItems(),attrs:r})};return e.createElement("div",{className:"form-editor-toolbar-content"},e.createElement(s,{type:"link",icon:"eye",onClick:function(){u(!0)}},"预览"),e.createElement(s,{type:"link",icon:"save",onClick:function(){return l(m())}},"保存"),e.createElement(h,{title:"表单预览",centered:!0,visible:o,onCancel:function(){return u(!1)},footer:null,width:800},o?e.createElement(W,{form:JSON.parse(m())}):null))})),V="field",P="eidtable_field";var K=C((function(t){var n=t.name,a=t.text,r=l({item:{name:n,type:V},collect:function(e){return{isDragging:e.isDragging()}}}),i=r[0].isDragging,o=r[1];return e.createElement("div",{ref:o,className:"field",style:{opacity:i?.4:1}},a)})),z=[{name:"input",text:"文本框"},{name:"number",text:"数字框"},{name:"textarea",text:"文本域"},{name:"radio",text:"单选框"},{name:"checkbox",text:"多选框"},{name:"select",text:"下拉选择框"},{name:"text",text:"文字"}],j=[{name:"result",text:"检验结果"}];function F(){var t=function(t,n){return e.createElement("div",null,e.createElement("div",{className:"label"},t),n.map((function(t,n,a){if(n%2==0){var r=a.slice(n,n+2);return e.createElement(y,{gutter:10,key:n},r.map((function(t,a){return e.createElement(g,{span:12,key:n+"-"+a},e.createElement(K,{name:t.name,text:t.text}))})))}return null})))};return e.createElement(e.Fragment,null,t("通用字段",z),t("自定义字段",j))}var G=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return k(n,t),n.prototype.render=function(){var t=this.props.formAttrs;return e.createElement("div",{className:"attrs"},e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"表单宽度"),e.createElement(f,{className:"input",value:t.formWidth,min:0,step:1,onChange:function(e){void 0!==e&&(t.formWidth=e)}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"表单宽度单位"),e.createElement(p.Group,{className:"input",value:t.formWidthUnit,buttonStyle:"solid",onChange:function(e){t.formWidthUnit=e.target.value}},e.createElement(p.Button,{value:"%"},"百分比 %"),e.createElement(p.Button,{value:"px"},"像素 px "))),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"标签宽度"),e.createElement(f,{className:"input",value:t.labelWidth,min:0,step:1,onChange:function(e){void 0!==e&&(t.labelWidth=e)}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"标签宽度单位"),e.createElement(p.Group,{className:"input",value:t.labelWidthUnit,buttonStyle:"solid",onChange:function(e){t.labelWidthUnit=e.target.value}},e.createElement(p.Button,{value:"%"},"百分比 %"),e.createElement(p.Button,{value:"px"},"像素 px "))),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"标签对齐方式"),e.createElement(p.Group,{className:"input",value:t.labelAlign,buttonStyle:"solid",onChange:function(e){t.labelAlign=e.target.value}},e.createElement(p.Button,{value:"left"},"左对齐"),e.createElement(p.Button,{value:"right"},"右对齐"),e.createElement(p.Button,{value:"top"},"顶部对齐"))))},n=D([C],n)}(e.Component),M=new(function(){function e(){this.formWidth=100,this.formWidthUnit="%",this.labelAlign="left",this.labelWidth=100,this.labelWidthUnit="px"}return Object.defineProperty(e.prototype,"formWidthString",{get:function(){return""+this.formWidth+this.formWidthUnit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labelWidthString",{get:function(){return""+this.labelWidth+this.labelWidthUnit},enumerable:!0,configurable:!0}),D([x],e.prototype,"formWidth",void 0),D([x],e.prototype,"formWidthUnit",void 0),D([x],e.prototype,"labelAlign",void 0),D([x],e.prototype,"labelWidth",void 0),D([x],e.prototype,"labelWidthUnit",void 0),D([O],e.prototype,"formWidthString",null),D([O],e.prototype,"labelWidthString",null),e}());var q=C((function(t){var n=t.form,a=n.activeItem,r=a.id,l=a.itemType,i=n.activeItem.labelText;function o(e){n.update(e)}var u,m=function(t){return e.createElement(e.Fragment,null,e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"输入提示"),e.createElement(d,{className:"input",value:t.placeholder,onChange:function(e){return o(B(B({},t),{placeholder:e.target.value}))}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"默认值"),e.createElement(d,{className:"input",value:t.defaultValue,onChange:function(e){return o(B(B({},t),{defaultValue:e.target.value}))}})))},c=function(t){var a=t.options;return e.createElement(e.Fragment,null,e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"选项"),e.createElement(b,{size:"small",itemLayout:"horizontal",dataSource:a,renderItem:function(a,r){return e.createElement(b.Item,{key:r},e.createElement("div",{className:"attr-item-option"},e.createElement(d,{value:a.value,onChange:function(e){n.updateOption(t.id,r,e.target.value)}}),e.createElement(s,{type:"danger",icon:"delete",className:"btn-delete-option",onClick:function(){return n.deleteOption(t.id,r)}},"删除")))}}),e.createElement(s,{type:"primary",onClick:function(){return n.addOption(t.id)},icon:"plus"},"添加选项")))},v=[U.INPUT,U.NUMBER,U.TEXTAREA,U.CHECKBOX,U.RADIO,U.SELECT].indexOf(l)>-1,h=[U.INPUT,U.TEXTAREA,U.CHECKBOX,U.RADIO].indexOf(l)>-1;return e.createElement("div",{className:"attrs"},e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"标识"),e.createElement(d,{className:"input",value:r,disabled:!0})),v?e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"标签文字"),e.createElement(d,{className:"input",value:i,onChange:function(e){return o(B(B({},n.activeItem),{}))}})):null,l===U.INPUT?m(n.activeItem):null,l===U.NUMBER?(u=n.activeItem,e.createElement(e.Fragment,null,e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"最小值"),e.createElement(f,{className:"input",value:u.min,onChange:function(e){return o(B(B({},u),{min:Number(e)}))}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"最大值"),e.createElement(f,{className:"input",value:u.max,onChange:function(e){return o(B(B({},u),{max:Number(e)}))}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"默认值"),e.createElement(f,{className:"input",value:u.defaultValue,min:u.min,max:u.max,onChange:function(e){return o(B(B({},u),{defaultValue:Number(e)}))}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"单位"),e.createElement(d,{className:"input",value:u.unit,onChange:function(e){return o(B(B({},u),{unit:e.target.value}))}})))):null,l===U.TEXTAREA?m(n.activeItem):null,l===U.CHECKBOX?c(n.activeItem):null,l===U.CHECKBOX?function(t){return e.createElement(e.Fragment,null,e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"默认值"),e.createElement(E,{mode:"tags",value:t.defaultValue,style:{width:"100%"},onChange:function(e){return n.setCheckboxDefaultOption(t.id,e)}},t.options.map((function(t,n){return e.createElement(E.Option,{key:n,value:t.value},t.value)})))))}(n.activeItem):null,l===U.RADIO?c(n.activeItem):null,l===U.RADIO?function(t){return e.createElement(e.Fragment,null,e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"默认值"),e.createElement(E,{value:t.defaultValue,style:{width:"100%"},onChange:function(e){return n.setRadioDefaultOption(t.id,e)}},t.options.map((function(t,n){return e.createElement(E.Option,{key:n,value:t.value},t.value)})))))}(n.activeItem):null,l===U.SELECT?c(n.activeItem):null,l===U.SELECT?function(t){return e.createElement(e.Fragment,null,e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"默认值"),e.createElement(E,{value:t.defaultValue,style:{width:"100%"},onChange:function(e){return n.setSelectDefaultOption(t.id,e)}},t.options.map((function(t,n){return e.createElement(E.Option,{key:n,value:t.value},t.value)})))))}(n.activeItem):null,l===U.LAYOUT?function(t){var a=t.rows;return e.createElement(e.Fragment,null,a.map((function(a,r){return e.createElement("div",{className:"attr-item",key:r},e.createElement("div",{className:"label"},"列宽"),e.createElement(b,{size:"small",itemLayout:"horizontal",dataSource:a,renderItem:function(a,l){return e.createElement(b.Item,{key:l},e.createElement("div",{className:"attr-item-option"},e.createElement(f,{className:"input",value:a.span,min:1,max:24,step:1,onChange:function(e){n.updateColSpan(t.id,r,l,Number(e))}}),e.createElement(s,{type:"danger",icon:"delete",className:"btn-delete-option",onClick:function(){return n.deleteCol(t.id,r,l)}},"删除")))}}),e.createElement(s,{type:"primary",onClick:function(){return n.addCol(t.id,r)},icon:"plus"},"添加列"))})))}(n.activeItem):null,l===U.TEXT?function(t){var a=t.id,r=t.content,l=t.fontSize,i=t.lineHeight,o=t.textAlign;return e.createElement(e.Fragment,null,e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"文字内容"),e.createElement(d.TextArea,{value:r,onChange:function(e){return n.updateTextItem(a,e.target.value,l,i,o)}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"文字大小"),e.createElement(f,{className:"input",value:l,min:12,max:100,step:1,onChange:function(e){return n.updateTextItem(a,r,Number(e),i,o)}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"文字行高"),e.createElement(f,{className:"input",value:i,min:12,max:100,step:1,onChange:function(e){return n.updateTextItem(a,r,l,Number(e),o)}})),e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"对齐方式"),e.createElement(E,{style:{width:"100%"},value:o,onChange:function(e){return n.updateTextItem(a,r,l,i,e)}},e.createElement(E.Option,{value:"left"},"左对齐"),e.createElement(E.Option,{value:"right"},"右对齐"),e.createElement(E.Option,{value:"center"},"居中"))))}(n.activeItem):null,h?function(t){return e.createElement(e.Fragment,null,e.createElement("div",{className:"attr-item"},e.createElement("div",{className:"label"},"是否必填"),e.createElement(p.Group,{value:t.required,onChange:function(e){return n.setRequired(t.id,e.target.value)}},e.createElement(p,{value:!0},"必填"),e.createElement(p,{value:!1},"选填"))))}(n.activeItem):null)})),_=T.TabPane,Y=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.onChangeTab=function(e){},e}return k(n,t),n.prototype.render=function(){return e.createElement(T,{onChange:this.onChangeTab,animated:!1},e.createElement(_,{tab:"字段属性",key:"field-attrs"},e.createElement(q,{form:L})),e.createElement(_,{tab:"表单属性",key:"form-attrs"},e.createElement(G,{formAttrs:M})))},n}(e.Component);var J=C((function(t){var a=t.formItem,r=t.formItemIndex,o=t.moveFormItem,u=n(null),m=i({accept:[P],hover:function(e,t){if(null!==u.current){var n=e.index,a=r;if(n!==a){var l=u.current.getBoundingClientRect(),i=(l.bottom-l.top)/2,m=t.getClientOffset();if(null!==m){var c=m.y-l.top;n<a&&c<i||n>a&&c>i||(o(n,a),e.index=a)}}}}})[1],c=l({item:{index:r,type:P},collect:function(e){return{isDragging:e.isDragging()}}}),h=c[0].isDragging;return(0,c[1])(m(u)),a.itemType===U.LAYOUT?e.createElement("div",{ref:u,className:S("field-editable field-editable-layout",a.isActive?"field-editable-active":""),style:{opacity:h?.4:1},onMouseDown:function(){return L.activate(a.id)}},a.rows.map((function(t,n){return e.createElement(y,{key:n,gutter:5},t.map((function(t,n){return e.createElement(g,{key:n,span:t.span})})))})),e.createElement(s,{className:"btn-delete",type:"danger",size:"small",icon:"delete",onClick:function(){return L.delete(a.id)}},"删除")):a.itemType===U.TEXT?e.createElement("div",{ref:u,className:S("field-editable field-editable-text",a.isActive?"field-editable-active":""),style:{opacity:h?.4:1},onMouseDown:function(){return L.activate(a.id)}},e.createElement("div",{style:{fontSize:a.fontSize,lineHeight:a.lineHeight+"px",textAlign:a.textAlign}},a.content),e.createElement(s,{className:"btn-delete",type:"danger",size:"small",icon:"delete",onClick:function(){return L.delete(a.id)}},"删除")):e.createElement("div",{ref:u,className:S("field-editable","top"===M.labelAlign?"label-standalone":"",a.isActive?"field-editable-active":""),style:{opacity:h?.4:1},onMouseDown:function(){return L.activate(a.id)}},e.createElement("div",{className:S("field-editable-label","top"===M.labelAlign?"field-standalone":""),style:B({width:M.labelWidth},"top"!==M.labelAlign?{textAlign:M.labelAlign}:{})},a.labelText),e.createElement("div",{className:"field-editable-content"},function(t){switch(t.itemType){case U.RESULT:return e.createElement("div",null,e.createElement(p.Group,{value:"合格",style:{height:32,lineHeight:"32px",marginBottom:16}},e.createElement(p,{value:"合格"},"合格"),e.createElement(p,{value:"不合格"},"不合格")),e.createElement(d.TextArea,{value:"",placeholder:"备注"}));case U.SELECT:var n=t;return e.createElement(E,{value:n.defaultValue,style:{width:"100%"}},n.options.map((function(t,n){return e.createElement(E.Option,{key:n,value:t.value},t.text)})));case U.CHECKBOX:var a=t;return e.createElement(v.Group,{value:a.defaultValue},a.options.map((function(t,n){return e.createElement(v,{key:n,value:t.value},t.text)})));case U.RADIO:var r=t;return e.createElement(p.Group,{value:r.defaultValue,buttonStyle:r.buttonStyle},r.options.map((function(t,n){return e.createElement(p.Button,{key:n,value:t.value},t.text)})));case U.TEXTAREA:var l=t;return e.createElement(d.TextArea,{value:l.defaultValue,placeholder:l.placeholder});case U.NUMBER:var i=t;return e.createElement(f,{style:{width:"100%"},value:i.defaultValue,formatter:function(e){return e?e+" "+i.unit:i.min+" "+i.unit},parser:function(e){return Number(e?e.replace(" "+i.unit,""):i.min)}});default:var o=t;return e.createElement(d,{value:o.defaultValue||"",placeholder:o.placeholder})}}(a)),e.createElement(s,{className:"btn-delete",type:"danger",size:"small",icon:"delete",onClick:function(){return L.delete(a.id)}},"删除"))}));var $=C((function(t){var n=t.formAttrs,r=t.form,l=a((function(e,t){return r.move(e,t)}),[r.formItems]),o=i({accept:[V],drop:function(e,t){e.type===V&&r.add(e.name)},collect:function(e){return{isOver:e.isOver(),canDrop:e.canDrop()}}}),u=o[0],m=(u.isOver,u.canDrop,o[1]);return e.createElement("div",{ref:m,className:"editable-form",style:{width:n.formWidthString}},r.formItems.map((function(t,n){return e.createElement(J,{key:t.id,formItem:t,formItemIndex:n,moveFormItem:l})})))})),Q=N.Header,Z=N.Content,ee=N.Sider;export default function(t){var n=t.style,a=t.defaultFormItems,l=void 0===a?[]:a,i=t.onSave,m=void 0===i?console.log:i;return r((function(){L.setItems(l)}),[]),e.createElement(o,{backend:u},e.createElement(N,{className:"form-editor",style:n},e.createElement(ee,{theme:"light",className:"form-editor-components"},e.createElement(F,null)),e.createElement(N,{className:"form-editor-content"},e.createElement(N,{className:"form-editor-content-main"},e.createElement(Q,{className:"form-editor-toolbar"},e.createElement(H,{formAttrs:M,form:L,onSave:m})),e.createElement(Z,{className:"form-editor-editarea"},e.createElement($,{formAttrs:M,form:L}))),e.createElement(ee,{theme:"light",width:300,className:"form-editor-content-attrs"},e.createElement(Y,null)))))}
