!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("react-dnd"),require("react-dnd-html5-backend"),require("antd"),require("mobx-react"),require("mobx"),require("shortid"),require("immutability-helper"),require("classnames")):"function"==typeof define&&define.amd?define(["react","react-dnd","react-dnd-html5-backend","antd","mobx-react","mobx","shortid","immutability-helper","classnames"],t):(e=e||self).ReactFormEditor=t(e.React,e.ReactDnD,e.ReactDnDHTML5Backend,e.antd,e.mobxReact,e.mobx,e.shortid,e.update,e.classnames)}(this,(function(e,t,n,a,r,i,l,o,c){"use strict";var u="default"in e?e.default:e;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c;var m=r.observer((function(e){var t=e.form,n=e.formAttrs,r=e.onPreview,i=e.onSave,l=function(){return JSON.stringify({items:t.getItems(),attrs:n})};return u.createElement("div",{className:"form-editor-toolbar-content"},u.createElement(a.Button,{type:"link",icon:"eye",onClick:function(){return r(l())}},"预览"),u.createElement(a.Button,{type:"link",icon:"save",onClick:function(){return i(l())}},"保存"))})),s="field",d="eidtable_field";var p=r.observer((function(e){var n=e.name,a=e.text,r=t.useDrag({item:{name:n,type:s},collect:function(e){return{isDragging:e.isDragging()}}}),i=r[0].isDragging,l=r[1];return u.createElement("div",{ref:l,className:"field",style:{opacity:i?.4:1}},a)})),f=[{name:"input",text:"文本框"},{name:"textarea",text:"文本域"},{name:"checkbox",text:"多选框"},{name:"radio",text:"单选框"},{name:"select",text:"下拉选择框"},{name:"text",text:"文字"}],v=[{name:"result",text:"检验结果"}];function E(){var e=function(e,t){return u.createElement("div",null,u.createElement("div",{className:"label"},e),t.map((function(e,t,n){if(t%2==0){var r=n.slice(t,t+2);return u.createElement(a.Row,{gutter:10,key:t},r.map((function(e,n){return u.createElement(a.Col,{span:12,key:t+"-"+n},u.createElement(p,{name:e.name,text:e.text}))})))}return null})))};return u.createElement(u.Fragment,null,e("通用字段",f),e("自定义字段",v))}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function b(e,t){function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var y=function(){return(y=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function g(e,t,n,a){var r,i=arguments.length,l=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,a);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(l=(i<3?r(l):i>3?r(t,n,l):r(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l}var T,N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return b(t,e),t.prototype.render=function(){var e=this.props.formAttrs;return u.createElement("div",{className:"attrs"},u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"表单宽度"),u.createElement(a.InputNumber,{className:"input",value:e.formWidth,min:0,step:1,onChange:function(t){void 0!==t&&(e.formWidth=t)}})),u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"表单宽度单位"),u.createElement(a.Radio.Group,{className:"input",value:e.formWidthUnit,buttonStyle:"solid",onChange:function(t){e.formWidthUnit=t.target.value}},u.createElement(a.Radio.Button,{value:"%"},"百分比 %"),u.createElement(a.Radio.Button,{value:"px"},"像素 px "))),u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"标签宽度"),u.createElement(a.InputNumber,{className:"input",value:e.labelWidth,min:0,step:1,onChange:function(t){void 0!==t&&(e.labelWidth=t)}})),u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"标签宽度单位"),u.createElement(a.Radio.Group,{className:"input",value:e.labelWidthUnit,buttonStyle:"solid",onChange:function(t){e.labelWidthUnit=t.target.value}},u.createElement(a.Radio.Button,{value:"%"},"百分比 %"),u.createElement(a.Radio.Button,{value:"px"},"像素 px "))),u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"标签对齐方式"),u.createElement(a.Radio.Group,{className:"input",value:e.labelAlign,buttonStyle:"solid",onChange:function(t){e.labelAlign=t.target.value}},u.createElement(a.Radio.Button,{value:"left"},"左对齐"),u.createElement(a.Radio.Button,{value:"right"},"右对齐"),u.createElement(a.Radio.Button,{value:"top"},"顶部对齐"))))},t=g([r.observer],t)}(u.Component),C=new(function(){function e(){this.formWidth=100,this.formWidthUnit="%",this.labelAlign="left",this.labelWidth=100,this.labelWidthUnit="px"}return Object.defineProperty(e.prototype,"formWidthString",{get:function(){return""+this.formWidth+this.formWidthUnit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labelWidthString",{get:function(){return""+this.labelWidth+this.labelWidthUnit},enumerable:!0,configurable:!0}),g([i.observable],e.prototype,"formWidth",void 0),g([i.observable],e.prototype,"formWidthUnit",void 0),g([i.observable],e.prototype,"labelAlign",void 0),g([i.observable],e.prototype,"labelWidth",void 0),g([i.observable],e.prototype,"labelWidthUnit",void 0),g([i.computed],e.prototype,"formWidthString",null),g([i.computed],e.prototype,"labelWidthString",null),e}());!function(e){e.TEXT="text",e.INPUT="input",e.TEXTAREA="textarea",e.CHECKBOX="checkbox",e.RADIO="radio",e.SELECT="select",e.LAYOUT="layout",e.RESULT="result"}(T||(T={}));var O=function(e){var t=l.generate();switch(e){case T.RESULT:return{id:t,itemType:e,labelText:"检验结果"};case T.TEXT:return{id:t,itemType:e,content:"文字内容",fontSize:14,lineHeight:21,textAlign:"left"};case T.LAYOUT:return{id:t,itemType:e,rows:[[{span:12},{span:12}]]};case T.SELECT:return{id:t,itemType:e,labelText:"下拉选择框",options:[x("选项 1"),x("选项 2"),x("选项 3")],defaultValue:"选项 1"};case T.RADIO:return{id:t,itemType:e,labelText:"单选框",options:[x("选项 1"),x("选项 2")],buttonStyle:"solid",defaultValue:""};case T.CHECKBOX:return{id:t,itemType:e,labelText:"多选框",options:[x("选项 1")],defaultValue:[]};case T.TEXTAREA:return{id:t,itemType:e,labelText:"文本域",placeholder:"文本域输入提示",defaultValue:""};default:return{id:t,itemType:T.INPUT,labelText:"文本框",placeholder:"文本框输入提示",defaultValue:""}}},x=function(e){return{value:e,text:e}};var I=new(function(){function e(){this.items=[O(T.INPUT),O(T.TEXTAREA),O(T.CHECKBOX),O(T.RADIO),O(T.SELECT),O(T.TEXT),O(T.RESULT)],this.activeId=""}return e.prototype.getItems=function(){return this.items.slice(0)},e.prototype.add=function(e){if(e===T.RESULT&&this.items.filter((function(e){return e.itemType===T.RESULT})).length>0)a.message.error("检验结果字段只能有一个");else{var t=O(e);this.items.push(t)}},e.prototype.delete=function(e){this.items=this.items.filter((function(t){return t.id!==e}))},e.prototype.update=function(e){this.items=this.items.map((function(t){return t.id===e.id?e:t}))},e.prototype.activate=function(e){this.items.filter((function(t){return t.id===e})).length>0&&(this.activeId=e)},e.prototype.move=function(e,t){var n=this.items[e];this.items=o(this.items,{$splice:[[e,1],[t,0,n]]})},e.prototype.addOption=function(e){this.items=this.items.map((function(t){if(t.id===e&&[T.CHECKBOX,T.RADIO,T.SELECT].indexOf(t.itemType)>-1){t.options.push(x(""))}return t}))},e.prototype.deleteOption=function(e,t){this.items=this.items.map((function(n){return n.id===e&&[T.CHECKBOX,T.RADIO,T.SELECT].indexOf(n.itemType)>-1&&n.options.splice(t,1),n}))},e.prototype.updateOption=function(e,t,n){this.items=this.items.map((function(a){return a.id===e&&[T.CHECKBOX,T.RADIO,T.SELECT].indexOf(a.itemType)>-1&&a.options.splice(t,1,x(n)),a}))},e.prototype.setCheckboxDefaultOption=function(e,t){this.items=this.items.map((function(n){return n.id===e&&T.CHECKBOX===n.itemType&&(n.defaultValue=t),n}))},e.prototype.setRadioDefaultOption=function(e,t){this.items=this.items.map((function(n){return n.id===e&&T.RADIO===n.itemType&&(n.defaultValue=t),n}))},e.prototype.setSelectDefaultOption=function(e,t){this.items=this.items.map((function(n){return n.id===e&&T.SELECT===n.itemType&&(n.defaultValue=t),n}))},e.prototype.addCol=function(e,t){this.items=this.items.map((function(n){return n.id===e&&T.LAYOUT===n.itemType&&n.rows[t].push({span:12}),n}))},e.prototype.updateColSpan=function(e,t,n,a){this.items=this.items.map((function(r){return r.id===e&&T.LAYOUT===r.itemType&&r.rows[t].splice(n,1,{span:a}),r}))},e.prototype.deleteCol=function(e,t,n){this.items=this.items.map((function(a){return a.id===e&&T.LAYOUT===a.itemType&&a.rows[t].splice(n,1),a}))},e.prototype.updateTextItem=function(e,t,n,a,r){this.items=this.items.map((function(i){return i.id===e&&T.TEXT===i.itemType&&(i.content=t,i.fontSize=n,i.lineHeight=a,i.textAlign=r),i}))},Object.defineProperty(e.prototype,"formItems",{get:function(){var e=this;return this.items.map((function(t){return y(y({},t),{isActive:t.id===e.activeId})}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeItem",{get:function(){return function(e,t){for(var n=null,a=0,r=e.length;a<r;a++){var i=e[a];if(i.id===t){n=i;break}}return n||{}}(this.items,this.activeId)},enumerable:!0,configurable:!0}),g([i.observable],e.prototype,"items",void 0),g([i.observable],e.prototype,"activeId",void 0),e}());var A=r.observer((function(e){var t=e.form,n=t.activeItem,r=n.id,i=n.itemType,l=t.activeItem.labelText;function o(e){t.update(e)}var c,m=function(e){return u.createElement(u.Fragment,null,u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"输入提示"),u.createElement(a.Input,{className:"input",value:e.placeholder,onChange:function(t){return o(y(y({},e),{placeholder:t.target.value}))}})),u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"默认值"),u.createElement(a.Input,{className:"input",value:e.defaultValue,onChange:function(t){return o(y(y({},e),{defaultValue:t.target.value}))}})))},s=function(e){var n=e.options;return u.createElement(u.Fragment,null,u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"选项"),u.createElement(a.List,{size:"small",itemLayout:"horizontal",dataSource:n,renderItem:function(n,r){return u.createElement(a.List.Item,{key:r},u.createElement("div",{className:"attr-item-option"},u.createElement(a.Input,{value:n.value,onChange:function(n){t.updateOption(e.id,r,n.target.value)}}),u.createElement(a.Button,{type:"danger",icon:"delete",className:"btn-delete-option",onClick:function(){return t.deleteOption(e.id,r)}},"删除")))}}),u.createElement(a.Button,{type:"primary",onClick:function(){return t.addOption(e.id)},icon:"plus"},"添加选项")))},d=[T.INPUT,T.TEXTAREA,T.CHECKBOX,T.RADIO,T.SELECT].indexOf(i)>-1;return u.createElement("div",{className:"attrs"},u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"标识"),u.createElement(a.Input,{className:"input",value:r,disabled:!0})),d?u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"标签文字"),u.createElement(a.Input,{className:"input",value:l,onChange:function(e){return o(y(y({},t.activeItem),{}))}})):null,i===T.INPUT?m(t.activeItem):null,i===T.TEXTAREA?m(t.activeItem):null,i===T.CHECKBOX?s(t.activeItem):null,i===T.CHECKBOX?(c=t.activeItem,u.createElement(u.Fragment,null,u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"默认值"),u.createElement(a.Select,{mode:"tags",value:c.defaultValue,style:{width:"100%"},onChange:function(e){return t.setCheckboxDefaultOption(c.id,e)}},c.options.map((function(e,t){return u.createElement(a.Select.Option,{key:t,value:e.value},e.value)})))))):null,i===T.RADIO?s(t.activeItem):null,i===T.RADIO?function(e){return u.createElement(u.Fragment,null,u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"默认值"),u.createElement(a.Select,{value:e.defaultValue,style:{width:"100%"},onChange:function(n){return t.setRadioDefaultOption(e.id,n)}},e.options.map((function(e,t){return u.createElement(a.Select.Option,{key:t,value:e.value},e.value)})))))}(t.activeItem):null,i===T.SELECT?s(t.activeItem):null,i===T.SELECT?function(e){return u.createElement(u.Fragment,null,u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"默认值"),u.createElement(a.Select,{value:e.defaultValue,style:{width:"100%"},onChange:function(n){return t.setSelectDefaultOption(e.id,n)}},e.options.map((function(e,t){return u.createElement(a.Select.Option,{key:t,value:e.value},e.value)})))))}(t.activeItem):null,i===T.LAYOUT?function(e){var n=e.rows;return u.createElement(u.Fragment,null,n.map((function(n,r){return u.createElement("div",{className:"attr-item",key:r},u.createElement("div",{className:"label"},"列宽"),u.createElement(a.List,{size:"small",itemLayout:"horizontal",dataSource:n,renderItem:function(n,i){return u.createElement(a.List.Item,{key:i},u.createElement("div",{className:"attr-item-option"},u.createElement(a.InputNumber,{className:"input",value:n.span,min:1,max:24,step:1,onChange:function(n){t.updateColSpan(e.id,r,i,Number(n))}}),u.createElement(a.Button,{type:"danger",icon:"delete",className:"btn-delete-option",onClick:function(){return t.deleteCol(e.id,r,i)}},"删除")))}}),u.createElement(a.Button,{type:"primary",onClick:function(){return t.addCol(e.id,r)},icon:"plus"},"添加列"))})))}(t.activeItem):null,i===T.TEXT?function(e){var n=e.id,r=e.content,i=e.fontSize,l=e.lineHeight,o=e.textAlign;return u.createElement(u.Fragment,null,u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"文字内容"),u.createElement(a.Input.TextArea,{value:r,onChange:function(e){return t.updateTextItem(n,e.target.value,i,l,o)}})),u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"文字大小"),u.createElement(a.InputNumber,{className:"input",value:i,min:12,max:100,step:1,onChange:function(e){return t.updateTextItem(n,r,Number(e),l,o)}})),u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"文字行高"),u.createElement(a.InputNumber,{className:"input",value:l,min:12,max:100,step:1,onChange:function(e){return t.updateTextItem(n,r,i,Number(e),o)}})),u.createElement("div",{className:"attr-item"},u.createElement("div",{className:"label"},"对齐方式"),u.createElement(a.Select,{style:{width:"100%"},value:o,onChange:function(e){return t.updateTextItem(n,r,i,l,e)}},u.createElement(a.Select.Option,{value:"left"},"左对齐"),u.createElement(a.Select.Option,{value:"right"},"右对齐"),u.createElement(a.Select.Option,{value:"center"},"居中"))))}(t.activeItem):null)})),S=a.Tabs.TabPane,R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeTab=function(e){},t}return b(t,e),t.prototype.render=function(){return u.createElement(a.Tabs,{onChange:this.onChangeTab,animated:!1},u.createElement(S,{tab:"字段属性",key:"field-attrs"},u.createElement(A,{form:I})),u.createElement(S,{tab:"表单属性",key:"form-attrs"},u.createElement(N,{formAttrs:C})))},t}(u.Component);var k=r.observer((function(n){var r=n.formItem,i=n.formItemIndex,l=n.moveFormItem,o=e.useRef(null),m=t.useDrop({accept:[d],hover:function(e,t){if(null!==o.current){var n=e.index,a=i;if(n!==a){var r=o.current.getBoundingClientRect(),c=(r.bottom-r.top)/2,u=t.getClientOffset();if(null!==u){var m=u.y-r.top;n<a&&m<c||n>a&&m>c||(l(n,a),e.index=a)}}}}})[1],s=t.useDrag({item:{index:i,type:d},collect:function(e){return{isDragging:e.isDragging()}}}),p=s[0].isDragging;return(0,s[1])(m(o)),r.itemType===T.LAYOUT?u.createElement("div",{ref:o,className:c("field-editable field-editable-layout",r.isActive?"field-editable-active":""),style:{opacity:p?.4:1},onMouseDown:function(){return I.activate(r.id)}},r.rows.map((function(e,t){return u.createElement(a.Row,{key:t,gutter:5},e.map((function(e,t){return u.createElement(a.Col,{key:t,span:e.span})})))})),u.createElement(a.Button,{className:"btn-delete",type:"danger",size:"small",icon:"delete",onClick:function(){return I.delete(r.id)}},"删除")):r.itemType===T.TEXT?u.createElement("div",{ref:o,className:c("field-editable field-editable-text",r.isActive?"field-editable-active":""),style:{opacity:p?.4:1},onMouseDown:function(){return I.activate(r.id)}},u.createElement("div",{style:{fontSize:r.fontSize,lineHeight:r.lineHeight+"px",textAlign:r.textAlign}},r.content),u.createElement(a.Button,{className:"btn-delete",type:"danger",size:"small",icon:"delete",onClick:function(){return I.delete(r.id)}},"删除")):u.createElement("div",{ref:o,className:c("field-editable","top"===C.labelAlign?"label-standalone":"",r.isActive?"field-editable-active":""),style:{opacity:p?.4:1},onMouseDown:function(){return I.activate(r.id)}},u.createElement("div",{className:c("field-editable-label","top"===C.labelAlign?"field-editable-label-top":""),style:y({width:C.labelWidth},"top"!==C.labelAlign?{textAlign:C.labelAlign}:{})},r.labelText),u.createElement("div",{className:"field-editable-content"},function(e){switch(e.itemType){case T.RESULT:return u.createElement("div",null,u.createElement(a.Radio.Group,{defaultValue:"",style:{height:32,lineHeight:"32px",marginBottom:16}},u.createElement(a.Radio,{value:"合格"},"合格"),u.createElement(a.Radio,{value:"不合格"},"不合格")),u.createElement(a.Input.TextArea,{placeholder:"备注"}));case T.SELECT:var t=e;return u.createElement(a.Select,{value:t.defaultValue,style:{width:"100%"}},t.options.map((function(e,t){return u.createElement(a.Select.Option,{key:t,value:e.value},e.text)})));case T.CHECKBOX:var n=e;return u.createElement(a.Checkbox.Group,{value:n.defaultValue},n.options.map((function(e,t){return u.createElement(a.Checkbox,{key:t,value:e.value},e.text)})));case T.RADIO:var r=e;return u.createElement(a.Radio.Group,{value:r.defaultValue,buttonStyle:r.buttonStyle},r.options.map((function(e,t){return u.createElement(a.Radio.Button,{key:t,value:e.value},e.text)})));case T.TEXTAREA:var i=e;return u.createElement(a.Input.TextArea,{value:i.defaultValue,placeholder:i.placeholder});default:var l=e;return u.createElement(a.Input,{value:l.defaultValue||"",placeholder:l.placeholder})}}(r)),u.createElement(a.Button,{className:"btn-delete",type:"danger",size:"small",icon:"delete",onClick:function(){return I.delete(r.id)}},"删除"))}));var D=r.observer((function(n){var a=n.formAttrs,r=n.form,i=e.useCallback((function(e,t){return r.move(e,t)}),[r.formItems]),l=t.useDrop({accept:[s],drop:function(e,t){e.type===s&&r.add(e.name)},collect:function(e){return{isOver:e.isOver(),canDrop:e.canDrop()}}}),o=l[0],c=(o.isOver,o.canDrop,l[1]);return u.createElement("div",{ref:c,className:"editable-form",style:{width:a.formWidthString}},r.formItems.map((function(e,t){return u.createElement(k,{key:e.id,formItem:e,formItemIndex:t,moveFormItem:i})})))}));const L=require("react-dom");require("./dist").observerBatching(L.unstable_batchedUpdates);var w=a.Layout.Header,B=a.Layout.Content,U=a.Layout.Sider;return function(e){var r=e.style,i=e.onPreview,l=void 0===i?console.log:i,o=e.onSave,c=void 0===o?console.log:o;return u.createElement(t.DndProvider,{backend:n},u.createElement(a.Layout,{className:"form-editor",style:r},u.createElement(U,{theme:"light",className:"form-editor-components"},u.createElement(E,null)),u.createElement(a.Layout,{className:"form-editor-content"},u.createElement(a.Layout,{className:"form-editor-content-main"},u.createElement(w,{className:"form-editor-toolbar"},u.createElement(m,{formAttrs:C,form:I,onPreview:l,onSave:c})),u.createElement(B,{className:"form-editor-editarea"},u.createElement(D,{formAttrs:C,form:I}))),u.createElement(U,{theme:"light",width:300,className:"form-editor-content-attrs"},u.createElement(R,null)))))}}));
